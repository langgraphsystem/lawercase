# üìä Document Generation Monitor - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

## –û–±–∑–æ—Ä

**index.html** - —ç—Ç–æ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –æ–¥–Ω–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º–æ–π mega_agent_pro –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ polling
‚úÖ **–¢—Ä–µ—Ö–ø–∞–Ω–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä, –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚úÖ **Mock —Ä–µ–∂–∏–º** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ backend
‚úÖ **Responsive –¥–∏–∑–∞–π–Ω** - –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤
‚úÖ **Accessibility** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ screen readers
‚úÖ **–ù—É–ª–µ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - —á–∏—Å—Ç—ã–π HTML/CSS/JavaScript

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ backend

1. –û—Ç–∫—Ä–æ–π—Ç–µ `index.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"üß™ Use Mock Data"** –≤ header
3. –ù–∞–∂–º–∏—Ç–µ **"üöÄ –ù–∞—á–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é"**
4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ —Å–∏–º—É–ª—è—Ü–∏–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞

Mock —Ä–µ–∂–∏–º —Å–∏–º—É–ª–∏—Ä—É–µ—Ç:
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é 5 —Å–µ–∫—Ü–∏–π –ø–µ—Ç–∏—Ü–∏–∏
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ (pending ‚Üí in_progress ‚Üí completed)
- –ó–∞–≥—Ä—É–∑–∫—É exhibit —Ñ–∞–π–ª–æ–≤
- Real-time –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Ç–æ–∫–µ–Ω—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å, ETA)

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º backend

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ API endpoints** –≤ JavaScript (—Å—Ç—Ä–æ–∫–∞ ~660):

```javascript
const CONFIG = {
  API_BASE: 'http://localhost:8000/api',  // –í–∞—à FastAPI backend
  POLL_INTERVAL: 2000,                     // –ò–Ω—Ç–µ—Ä–≤–∞–ª polling (ms)
  MAX_POLL_ERRORS: 5,                      // –ú–∞–∫—Å. –æ—à–∏–±–æ–∫ –¥–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
  MOCK_MODE: false,                        // false –¥–ª—è production
};
```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω** –Ω–∞ FastAPI:

```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # –í production —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

3. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ API endpoints** (—Å–º. —Ä–∞–∑–¥–µ–ª "API Specification" –Ω–∏–∂–µ)

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É**:

```bash
# Terminal 1: Backend
uvicorn api.main:app --reload --port 8000

# Terminal 2: Frontend (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è dev server)
python -m http.server 8080
# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080/index.html
```

---

## üì° API Specification

Backend –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ endpoints:

### 1. POST `/api/generate-petition`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**Request Body**:
```json
{
  "case_id": "string",
  "document_type": "petition" | "letter" | "memo",
  "user_id": "string"
}
```

**Response**:
```json
{
  "thread_id": "string",
  "status": "generating",
  "message": "Document generation started"
}
```

---

### 2. GET `/api/document/preview/{thread_id}`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–¥–ª—è polling)

**Response** (TypeScript schema –¥–ª—è reference):
```typescript
interface DocumentPreviewResponse {
  thread_id: string;
  status: 'idle' | 'generating' | 'paused' | 'completed' | 'error';

  sections: Array<{
    section_id: string;           // "intro", "awards", etc.
    section_name: string;          // "I. INTRODUCTION"
    section_order: number;         // 1, 2, 3...
    status: 'pending' | 'in_progress' | 'completed' | 'error';
    content_html: string;          // HTML —Å —É–∂–µ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏
    updated_at: string;            // ISO timestamp
    tokens_used?: number;
    error_message?: string;
  }>;

  exhibits: Array<{
    exhibit_id: string;            // "2.1.A"
    filename: string;              // "Award_Certificate.pdf"
    file_path: string;             // URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    file_size: number;             // bytes
    mime_type: string;             // "application/pdf"
    uploaded_at: string;           // ISO timestamp
  }>;

  metadata: {
    total_sections: number;
    completed_sections: number;
    progress_percentage: number;   // 0-100
    elapsed_time: number;          // seconds
    estimated_remaining: number;   // seconds
    total_tokens: number;
    estimated_cost: number;        // USD
  };

  logs: Array<{
    timestamp: string;             // ISO timestamp
    level: 'info' | 'success' | 'error' | 'warning';
    message: string;
    agent?: string;                // "WriterAgent", "SupervisorAgent", etc.
  }>;
}
```

**–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏**:

- **content_html** –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π HTML —Å inline —Å—Ç–∏–ª—è–º–∏ –∫–ª–∞—Å—Å–æ–≤ (`.bold`, `.italic`, `.center` –∏ —Ç.–¥.)
- **section_order** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–∫—Ü–∏–π
- Frontend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- Polling –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

---

### 3. POST `/api/upload-exhibit/{thread_id}`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–≥—Ä—É–∑–∫–∞ exhibit —Ñ–∞–π–ª–∞

**Request** (multipart/form-data):
```
exhibit_id: string (form field)
file: File (binary)
```

**Response**:
```json
{
  "success": true,
  "exhibit_id": "2.1.A",
  "filename": "Award_Certificate.pdf",
  "file_path": "/exhibits/2.1.A.pdf"
}
```

---

### 4. GET `/api/download-petition-pdf/{thread_id}`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞

**Response**: Binary PDF file with appropriate headers
```
Content-Type: application/pdf
Content-Disposition: attachment; filename="petition_{thread_id}.pdf"
```

---

### 5. POST `/api/pause/{thread_id}` *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)*

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**Response**:
```json
{
  "status": "paused",
  "message": "Generation paused"
}
```

---

### 6. POST `/api/resume/{thread_id}` *(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)*

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**Response**:
```json
{
  "status": "generating",
  "message": "Generation resumed"
}
```

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ CSS variables –≤ `:root` (—Å—Ç—Ä–æ–∫–∞ ~140):

```css
:root {
  --color-primary: #0066cc;      /* –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç */
  --color-success: #28a745;      /* –£—Å–ø–µ—Ö */
  --color-warning: #ffc107;      /* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ */
  --color-danger: #dc3545;       /* –û—à–∏–±–∫–∞ */
  /* ... */
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ polling

```javascript
const CONFIG = {
  POLL_INTERVAL: 3000,  // 3 —Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ 2
  // ...
};
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞

–°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å–µ–∫—Ü–∏–∏ `#document-preview` (—Å—Ç—Ä–æ–∫–∞ ~435):

```css
#document-preview {
  font-family: var(--font-document);  /* Times New Roman */
  font-size: 11pt;                    /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
  line-height: 1.5;                   /* –ú–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª */
  /* ... */
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ–∫—Ü–∏–π –≤ sidebar

–°–µ–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `sections` array –≤ API response.
–î–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `UI.updateSidebar()` (—Å—Ç—Ä–æ–∫–∞ ~1080).

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
index.html
‚îú‚îÄ‚îÄ HTML (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ Header (app-header)
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar (section/exhibit lists)
‚îÇ   ‚îú‚îÄ‚îÄ Main Content (document preview)
‚îÇ   ‚îî‚îÄ‚îÄ Controls Panel (buttons, stats, logs)
‚îÇ
‚îú‚îÄ‚îÄ CSS (—Å—Ç–∏–ª–∏)
‚îÇ   ‚îú‚îÄ‚îÄ Variables (colors, spacing, fonts)
‚îÇ   ‚îú‚îÄ‚îÄ Layout (grid, flexbox)
‚îÇ   ‚îú‚îÄ‚îÄ Components (buttons, forms, cards)
‚îÇ   ‚îú‚îÄ‚îÄ Document styles (Times New Roman, formatting)
‚îÇ   ‚îî‚îÄ‚îÄ Responsive (media queries)
‚îÇ
‚îî‚îÄ‚îÄ JavaScript (–ª–æ–≥–∏–∫–∞)
    ‚îú‚îÄ‚îÄ CONFIG (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
    ‚îú‚îÄ‚îÄ API_ENDPOINTS (–º–∞—Ä—à—Ä—É—Ç—ã)
    ‚îú‚îÄ‚îÄ MOCK_DATA (—Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
    ‚îú‚îÄ‚îÄ DocumentMonitor (–∫–ª–∞—Å—Å –¥–ª—è polling)
    ‚îú‚îÄ‚îÄ UI (–º–µ—Ç–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
    ‚îî‚îÄ‚îÄ Event Handlers (–∫–Ω–æ–ø–∫–∏, —Ñ–æ—Ä–º—ã)
```

### –ö–ª–∞—Å—Å DocumentMonitor

```javascript
class DocumentMonitor {
  constructor(threadId, options)
  async startPolling()           // –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  async poll()                   // –û–¥–∏–Ω —Ü–∏–∫–ª polling
  async fetchStatus()            // –ó–∞–ø—Ä–æ—Å –∫ API
  async getMockData()            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è mock –¥–∞–Ω–Ω—ã—Ö
  updateUI(data)                 // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ UI
  stopPolling()                  // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  onComplete(data)               // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  onError(data)                  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏
}
```

### –û–±—ä–µ–∫—Ç UI

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```javascript
const UI = {
  updateSidebar(sections, exhibits)    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
  updateMainContent(sections)          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  updateStatistics(metadata)           // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  updateLogs(logs)                     // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤
  addLog(level, message, agent)        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ª–æ–≥–∞
  updateControlButtons(status)         // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫

  // Utility –º–µ—Ç–æ–¥—ã
  scrollToSection(sectionId)
  getStatusIcon(status)
  getFileIcon(mimeType)
  formatFileSize(bytes)
  formatDuration(seconds)
  formatTimeAgo(timestamp)
  showNotification(message, type)
}
```

---

## üîß Backend Implementation Example

### FastAPI endpoint –¥–ª—è `/api/document/preview/{thread_id}`

```python
from fastapi import APIRouter, HTTPException
from typing import List, Dict, Any, Literal
from pydantic import BaseModel
from datetime import datetime

router = APIRouter(prefix="/api", tags=["document"])

# Schemas
class Section(BaseModel):
    section_id: str
    section_name: str
    section_order: int
    status: Literal["pending", "in_progress", "completed", "error"]
    content_html: str
    updated_at: datetime
    tokens_used: int | None = None
    error_message: str | None = None

class Exhibit(BaseModel):
    exhibit_id: str
    filename: str
    file_path: str
    file_size: int
    mime_type: str
    uploaded_at: datetime

class Metadata(BaseModel):
    total_sections: int
    completed_sections: int
    progress_percentage: float
    elapsed_time: int
    estimated_remaining: int
    total_tokens: int
    estimated_cost: float

class Log(BaseModel):
    timestamp: datetime
    level: Literal["info", "success", "error", "warning"]
    message: str
    agent: str | None = None

class DocumentPreviewResponse(BaseModel):
    thread_id: str
    status: Literal["idle", "generating", "paused", "completed", "error"]
    sections: List[Section]
    exhibits: List[Exhibit]
    metadata: Metadata
    logs: List[Log]

# Endpoint
@router.get("/document/preview/{thread_id}", response_model=DocumentPreviewResponse)
async def get_document_preview(thread_id: str):
    """Get current status of document generation."""

    # TODO: –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –≤–∞—à–µ–≥–æ workflow state
    # –ù–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ LangGraph checkpointer –∏–ª–∏ database

    workflow_state = await get_workflow_state(thread_id)

    if not workflow_state:
        raise HTTPException(status_code=404, detail="Thread not found")

    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞—à–µ–≥–æ WorkflowState –≤ DocumentPreviewResponse
    return DocumentPreviewResponse(
        thread_id=thread_id,
        status=workflow_state.workflow_step,
        sections=[
            Section(
                section_id=sec.id,
                section_name=sec.name,
                section_order=sec.order,
                status=sec.status,
                content_html=sec.html_content,
                updated_at=sec.updated_at,
                tokens_used=sec.tokens,
            )
            for sec in workflow_state.sections
        ],
        exhibits=workflow_state.exhibits,
        metadata=calculate_metadata(workflow_state),
        logs=workflow_state.logs[-50:],  # Last 50 logs
    )

async def get_workflow_state(thread_id: str):
    """Retrieve workflow state from checkpointer or database."""
    # –í–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –Ω–∞–ø—Ä–∏–º–µ—Ä:
    # return await memory_manager.get_state(thread_id)
    pass

def calculate_metadata(state) -> Metadata:
    """Calculate metadata from workflow state."""
    completed = sum(1 for s in state.sections if s.status == "completed")
    total = len(state.sections)

    return Metadata(
        total_sections=total,
        completed_sections=completed,
        progress_percentage=(completed / total * 100) if total > 0 else 0,
        elapsed_time=int((datetime.now() - state.started_at).total_seconds()),
        estimated_remaining=estimate_remaining_time(state),
        total_tokens=sum(s.tokens or 0 for s in state.sections),
        estimated_cost=calculate_cost(state),
    )
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LangGraph workflow

```python
from langgraph.graph import StateGraph
from core.orchestration.workflow_graph import WorkflowState

async def document_generation_workflow(
    case_id: str,
    thread_id: str,
    user_id: str
) -> None:
    """Run document generation workflow with state updates."""

    # –°–æ–∑–¥–∞—Ç—å workflow state
    state = WorkflowState(
        thread_id=thread_id,
        user_id=user_id,
        case_id=case_id,
        workflow_step="generating",
        document_data={
            "sections": [
                {"id": "intro", "name": "I. INTRODUCTION", "order": 1, "status": "pending"},
                {"id": "background", "name": "II. BACKGROUND", "order": 2, "status": "pending"},
                # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏
            ],
            "exhibits": [],
            "logs": [],
        }
    )

    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    await save_state(thread_id, state)

    # –ó–∞–ø—É—Å—Ç–∏—Ç—å LangGraph workflow
    graph = build_eb1a_workflow()

    async for event in graph.astream(state, thread_id=thread_id):
        # –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –æ–±–Ω–æ–≤–ª—è–µ–º state
        updated_state = event["state"]
        await save_state(thread_id, updated_state)

        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        await log_event(thread_id, {
            "timestamp": datetime.now(),
            "level": "info",
            "message": f"Completed node: {event['node']}",
            "agent": event.get("agent_name"),
        })
```

---

## üéØ Best Practices

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**Throttle/Debounce –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**:

```javascript
// –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–¥ updateUI –≤ DocumentMonitor
let updateTimeout;
updateUI(data) {
  clearTimeout(updateTimeout);
  updateTimeout = setTimeout(() => {
    UI.updateSidebar(data.sections, data.exhibits);
    UI.updateMainContent(data.sections);
    UI.updateStatistics(data.metadata);
    UI.updateLogs(data.logs);
    UI.updateControlButtons(data.status);
  }, 100); // Debounce 100ms
}
```

**Lazy rendering –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**:

```javascript
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Intersection Observer –¥–ª—è lazy load —Å–µ–∫—Ü–∏–π
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      // Render section content
      renderSection(entry.target.dataset.sectionId);
    }
  });
});
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**Graceful degradation**:

```javascript
async poll() {
  try {
    const data = await this.fetchStatus();
    // ...
  } catch (error) {
    // –ù–µ –ª–æ–º–∞–µ–º –≤–µ—Å—å UI, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º user-friendly —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (error.message.includes('NetworkError')) {
      UI.addLog('warning', '–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é, –ø–æ–≤—Ç–æ—Ä—è—é...', 'System');
    } else {
      UI.addLog('error', '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'System');
    }
  }
}
```

### 3. Accessibility

**Keyboard navigation**:

–í—Å–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–∂–µ –∏–º–µ—é—Ç:
- `tabindex` –¥–ª—è —Ñ–æ–∫—É—Å–∞
- Event handlers –¥–ª—è `Enter` –∏ `Space`
- ARIA labels –¥–ª—è –∏–∫–æ–Ω–æ–∫

**Screen reader support**:

```html
<span class="status-icon" aria-label="Section completed">‚úÖ</span>
```

### 4. Security

**Sanitize HTML content**:

–í–ê–ñ–ù–û: Backend –¥–æ–ª–∂–µ–Ω —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å `content_html` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π!

```python
import bleach

ALLOWED_TAGS = ['h1', 'h2', 'h3', 'p', 'span', 'div', 'ul', 'ol', 'li', 'a']
ALLOWED_ATTRIBUTES = {'span': ['class'], 'div': ['class'], 'a': ['href', 'class']}

def sanitize_html(html: str) -> str:
    return bleach.clean(
        html,
        tags=ALLOWED_TAGS,
        attributes=ALLOWED_ATTRIBUTES,
        strip=True
    )
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Polling –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞**: CORS –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API_BASE

**–†–µ—à–µ–Ω–∏–µ**:
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Network tab
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API
3. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ CORS –æ—à–∏–±–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ backend (—Å–º. –≤—ã—à–µ)
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `API_BASE` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ–∫—Ü–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `content_html`

**–†–µ—à–µ–Ω–∏–µ**:
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ `console.log` –≤ `updateMainContent`
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `content_html` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π HTML
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª–∞—Å—Å—ã —Å—Ç–∏–ª–µ–π –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (`.bold`, `.center` –∏ —Ç.–¥.)

### –ü—Ä–æ–±–ª–µ–º–∞: Mock –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –õ–æ–≥–∏–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –≤ `getMockData()` —Å—Ç–∞—Ç–∏—á–Ω–∞

**–†–µ—à–µ–Ω–∏–µ**:
–ò–∑–º–µ–Ω–∏—Ç–µ –ª–æ–≥–∏–∫—É –≤ `getMockData()` –¥–ª—è –±–æ–ª–µ–µ –¥–∏–Ω–∞–º–∏—á–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏:

```javascript
async getMockData() {
  const elapsed = Math.floor((Date.now() - this.startTime) / 1000);

  // –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –∑–∞–≤–µ—Ä—à–∞—Ç—å –æ–¥–Ω—É —Å–µ–∫—Ü–∏—é
  const completedCount = Math.min(
    Math.floor(elapsed / 5),
    MOCK_DATA.sections.length
  );

  MOCK_DATA.sections.forEach((section, idx) => {
    if (idx < completedCount) {
      section.status = 'completed';
      section.content_html = `<h2>${section.section_name}</h2><p>Content...</p>`;
    } else if (idx === completedCount) {
      section.status = 'in_progress';
    } else {
      section.status = 'pending';
    }
  });

  return MOCK_DATA;
}
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

- `core/orchestration/workflow_graph.py` - LangGraph workflow definitions
- `core/groupagents/writer_agent.py` - WriterAgent implementation
- `core/workflows/eb1a/templates/section_templates.py` - Section templates
- `api/routes/agent.py` - Existing API routes
- `api/schemas.py` - Pydantic schemas

### –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã

- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)
- [CSS Grid Layout](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout)

---

## üîÆ Roadmap (–ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è)

### Phase 2 Features

- [ ] **WebSocket support** - –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç polling –∫ real-time updates
- [ ] **Human-in-the-loop UI** - modal dialogs –¥–ª—è approval/rejection
- [ ] **Version comparison** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø—Ä–∏ re-generation
- [ ] **Inline comments** - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ValidatorAgent –ø—Ä—è–º–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
- [ ] **Export logs** - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
- [ ] **Search in document** - Ctrl+F enhancement —Å highlighting
- [ ] **Multiple document tabs** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### Phase 3 Features

- [ ] **Collaborative editing** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ real-time
- [ ] **Analytics dashboard** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–º
- [ ] **Template library** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] **AI suggestions** - inline AI-powered improvements
- [ ] **Offline mode** - Service Worker –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ —Å–µ—Ç–∏

---

## üìÑ License

–≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –ø—Ä–æ–µ–∫—Ç–∞ **mega_agent_pro**.
–°–º. LICENSE —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

---

## ü§ù Contributing

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö features:

1. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ zero-dependency –ø—Ä–∏–Ω—Ü–∏–ø (—Ç–æ–ª—å–∫–æ vanilla JS)
2. –°–ª–µ–¥—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É code style
3. –î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ mock —Ä–µ–∂–∏–º–µ –ø–µ—Ä–µ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
5. –û–±–Ω–æ–≤–ª—è–π—Ç–µ —ç—Ç–æ—Ç README

---

## üìû Support

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ bug reports:
- GitHub Issues: [mega_agent_pro/issues](https://github.com/yourusername/mega_agent_pro/issues)
- Email: support@megaagentpro.com

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è mega_agent_pro project**
