# E2E Test Plan: MegaAgent Pro API

This document outlines the end-to-end test cases for the core API functionality.

| ID      | Endpoint                    | Test Case Description                                                              | Priority | Required Data Sets                                                              | Acceptance Criteria                                                                                                                                                                                                                                                        | 
| :------ | :-------------------------- | :--------------------------------------------------------------------------------- | :------- | :------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | 
| **Auth**|             |                                                                                    |        |                                                                                 |                                                                                                                                                                                                                                                                            |
| AUTH-01 | `POST /auth/token`          | User authenticates with valid credentials.                                         | P0       | A provisioned user account (`testuser`, `Str0ngP@ssw0rd!`).                       | - Returns HTTP 200 OK.<br>- Response body contains a valid `access_token` (JWT format) and `token_type` of 'bearer'.                                                                                                                                                  | 
| AUTH-02 | `POST /auth/token`          | User attempts to authenticate with invalid credentials.                            | P1       | An invalid username/password pair.                                              | - Returns HTTP 401 Unauthorized.                                                                                                                                                                                                                                           | 
| **Agents**|           |                                                                                    |        |                                                                                 |                                                                                                                                                                                                                                                                            |
| AGENT-01| `POST /agents`              | Create a new agent with an `llm_only` route policy.                                | P0       | Valid Agent JSON payload.                                                       | - Returns HTTP 201 Created.<br>- Response contains the full agent object, including a server-generated `id`.                                                                                                                                                              | 
| AGENT-02| `GET /agents`               | List all available agents.                                                         | P1       | At least one agent exists in the system.                                        | - Returns HTTP 200 OK.<br>- Response body is an array of Agent objects.                                                                                                                                                                                                    |
| AGENT-03| `GET /agents/{id}`          | Retrieve the details of a specific, existing agent.                                | P1       | A valid agent ID.                                                               | - Returns HTTP 200 OK.<br>- Response body is a single Agent object.                                                                                                                                                                                                        |
| AGENT-04| `GET /agents/{id}`          | Attempt to retrieve a non-existent agent.                                          | P2       | An invalid or non-existent agent ID.                                            | - Returns HTTP 404 Not Found.                                                                                                                                                                                                                                              |
| AGENT-05| `POST /agents/{id}/invoke`  | Invoke a simple `llm_only` agent with a basic prompt (e.g., 'tell me a joke').     | P0       | An existing `llm_only` agent ID.                                                | - Returns HTTP 200 OK.<br>- Response body conforms to `InvokeResponse.json` schema.<br>- `success` is true.<br>- `result` field contains a plausible, non-empty string.                                                                                                     | 
| AGENT-06| `POST /agents/{id}/invoke`  | Invoke a `rag_then_llm` agent with a query related to an indexed document.         | P0       | An existing `rag_then_llm` agent ID and an indexed document.                    | - Returns HTTP 200 OK.<br>- Response body conforms to `InvokeResponse.json` schema.<br>- `success` is true.<br>- `result` contains both a text response and context chunks.                                                                                                  |
| AGENT-07| `POST /agents/{id}/invoke`  | Invoke an agent with an invalid command or payload.                                | P1       | An existing agent ID.                                                           | - Returns HTTP 400 Bad Request.                                                                                                                                                                                                                                            |